â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DOCUMENTACIÃ“N: MEJORA DE ALMACENAMIENTO DE MÃ‰TODOS DE PAGO Y RETENCIÃ“N DE FUENTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Fecha: 2025-12-18
VersiÃ³n: 1.0
Backend: Spring Boot + JPA/Hibernate + MariaDB


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ RESUMEN DE CAMBIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Se agregaron columnas numÃ©ricas para almacenar montos de mÃ©todos de pago de forma
estructurada en las tablas `ordenes`, `abonos` y `entregas_dinero`, conservando
los campos de texto existentes para compatibilidad e informes.

OBJETIVO:
- Eliminar errores de parseo por formatos regionales
- Evitar descuadres contables por redondeos
- Permitir validaciones de integridad en base de datos
- Facilitar consultas y reportes numÃ©ricos exactos
- Mejorar auditorÃ­a de transacciones


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š CAMBIOS EN LA BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TABLA: ordenes
--------------
COLUMNAS AGREGADAS:
- monto_efectivo         DECIMAL(15,2) NOT NULL DEFAULT 0.00
- monto_transferencia    DECIMAL(15,2) NOT NULL DEFAULT 0.00
- monto_cheque          DECIMAL(15,2) NOT NULL DEFAULT 0.00

CONSTRAINT AGREGADO:
- check_suma_metodos_pago_orden
  Solo valida en Ã³rdenes de CONTADO (credito = false) Y cuando los campos tienen valores
  Permite registros existentes con valores en 0
  Verifica: monto_efectivo + monto_transferencia + monto_cheque = total - descuentos

CAMPO CONSERVADO:
- descripcion VARCHAR(3000): Se mantiene para informes y trazabilidad


TABLA: abonos
-------------
COLUMNAS AGREGADAS:
- monto_efectivo         DECIMAL(15,2) NOT NULL DEFAULT 0.00
- monto_transferencia    DECIMAL(15,2) NOT NULL DEFAULT 0.00
- monto_cheque          DECIMAL(15,2) NOT NULL DEFAULT 0.00
- monto_retencion       DECIMAL(15,2) NOT NULL DEFAULT 0.00

CONSTRAINT AGREGADO:
- check_suma_metodos_pago_abono
  Verifica: monto_efectivo + monto_transferencia + monto_cheque = total
  Permite registros existentes con valores en 0
  La retenciÃ³n NO se suma porque no es dinero que ingresa

CAMPO CONSERVADO:
- metodo_pago VARCHAR(3000): Se mantiene para informes y trazabilidad


TABLA: entregas_dinero
---------------------
COLUMNA AGREGADA:
- monto_retencion       DECIMAL(15,2) NOT NULL DEFAULT 0.00

EXPLICACIÃ“N:
El montoRetencion de la entrega es la SUMA de todos los montoRetencion
de los abonos incluidos en esa entrega.

CAMPOS EXISTENTES (sin cambios):
- monto_efectivo, monto_transferencia, monto_cheque, monto_deposito


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ CAMBIOS EN CÃ“DIGO JAVA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MODELOS (ENTITIES):
-------------------
âœ… Orden.java
   - Agregados: montoEfectivo, montoTransferencia, montoCheque
   - Tipo: Double (nullable = false, default 0.0)

âœ… Abono.java
   - Agregados: montoEfectivo, montoTransferencia, montoCheque, montoRetencion
   - Tipo: Double (nullable = false, default 0.0)

âœ… EntregaDinero.java
   - Agregado: montoRetencion
   - Tipo: Double (nullable = false, default 0.0)


DTOs:
-----
âœ… OrdenVentaDTO.java (para crear Ã³rdenes)
   - Agregados: montoEfectivo, montoTransferencia, montoCheque

âœ… AbonoDTO.java (para crear abonos)
   - Agregados: montoEfectivo, montoTransferencia, montoCheque, montoRetencion

âœ… OrdenParaEntregaDTO.java (para listar Ã³rdenes disponibles)
   - Agregados: montoEfectivo, montoTransferencia, montoCheque

âœ… AbonoParaEntregaDTO.java (para listar abonos disponibles)
   - Agregados: montoEfectivo, montoTransferencia, montoCheque, montoRetencion


SERVICIOS:
----------
âœ… OrdenService.java - MÃ©todo: crearOrdenVentaConCredito()
   - Se guardan los montos en las columnas numÃ©ricas al crear la orden
   - Se extraen desde el DTO: ventaDTO.getMontoEfectivo(), etc.

âœ… AbonoService.java - MÃ©todo: crearDesdeDTO()
   - Se guardan los montos en las columnas numÃ©ricas al crear el abono
   - VALIDACIÃ“N AGREGADA: Suma de mÃ©todos = total del abono (tolerancia 1 centavo)
   - Se lanza excepciÃ³n si no coincide

âœ… EntregaDineroController.java
   - MÃ©todo: convertirAOrdenParaEntregaDTO()
     â†’ Incluye montoEfectivo, montoTransferencia, montoCheque en el DTO
   - MÃ©todo: convertirAAbonoParaEntregaDTO()
     â†’ Incluye montoEfectivo, montoTransferencia, montoCheque, montoRetencion


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¡ ENDPOINTS AFECTADOS Y DOCUMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£ CREAR ORDEN DE VENTA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT: POST /api/ordenes
DESCRIPCIÃ“N: Crea una nueva orden de venta (contado o crÃ©dito)

REQUEST BODY (JSON):
--------------------
{
  "fecha": "2025-12-18",
  "clienteId": 7,
  "sedeId": 1,
  "trabajadorId": 3,
  "obra": "Proyecto Casa Blanca",
  "descripcion": "TRANSFERENCIA: 549.800 (BANCOLOMBIA)",
  "venta": true,
  "credito": false,
  "incluidaEntrega": false,
  "tieneRetencionFuente": false,
  "retencionFuente": 0,
  "descuentos": 0,
  
  // ğŸ†• CAMPOS NUEVOS: MONTOS POR MÃ‰TODO DE PAGO
  "montoEfectivo": 0,
  "montoTransferencia": 549800,
  "montoCheque": 0,
  
  "items": [
    {
      "productoId": 15,
      "descripcion": "Vidrio templado 6mm",
      "cantidad": 2,
      "precioUnitario": 274900
    }
  ]
}

VALIDACIONES:
-------------
- Si credito = false (orden de CONTADO):
  â†’ montoEfectivo + montoTransferencia + montoCheque = total - descuentos
  â†’ Si no coincide, error 400 Bad Request

- Si credito = true (orden a CRÃ‰DITO):
  â†’ montoEfectivo, montoTransferencia, montoCheque se guardan como 0.00

RESPONSE (200 OK):
------------------
{
  "id": 130,
  "numero": 1105,
  "fecha": "2025-12-18",
  "cliente": {
    "id": 7,
    "nombre": "Juan PÃ©rez",
    "nit": "123456789"
  },
  "sede": {
    "id": 1,
    "nombre": "Sede Principal"
  },
  "total": 549800,
  "subtotal": 462016.81,
  "iva": 87783.19,
  "descuentos": 0,
  "descripcion": "TRANSFERENCIA: 549.800 (BANCOLOMBIA)",
  
  // ğŸ†• CAMPOS NUEVOS EN RESPONSE
  "montoEfectivo": 0,
  "montoTransferencia": 549800,
  "montoCheque": 0,
  
  "credito": false,
  "tieneRetencionFuente": false,
  "retencionFuente": 0,
  "estado": "ACTIVA"
}


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2ï¸âƒ£ CREAR ABONO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT: POST /api/creditos/{creditoId}/abonos
DESCRIPCIÃ“N: Agrega un abono a un crÃ©dito existente

REQUEST BODY (JSON):
--------------------
{
  "total": 2555168.07,
  "fecha": "2025-12-18",
  "metodoPago": "TRANSFERENCIA: 2.555.168,07 (BANCOLOMBIA) | RETEFUENTE Orden #1102: 54.831,93",
  "factura": "F-2025-001",
  
  // ğŸ†• CAMPOS NUEVOS: MONTOS POR MÃ‰TODO DE PAGO
  "montoEfectivo": 0,
  "montoTransferencia": 2555168.07,
  "montoCheque": 0,
  "montoRetencion": 54831.93
}

VALIDACIONES:
-------------
âœ… OBLIGATORIO: montoEfectivo + montoTransferencia + montoCheque = total
   - Tolerancia: 0.01 (1 centavo por redondeo)
   - Si no coincide, error 400 Bad Request con mensaje:
     "La suma de los mÃ©todos de pago ($X) no coincide con el monto total ($Y)"

âœ… La retenciÃ³n (montoRetencion) NO se suma a los mÃ©todos de pago
   - Es un campo informativo/contable
   - Representa el dinero retenido en la fuente

âœ… El total del abono NO debe exceder el saldo pendiente del crÃ©dito

RESPONSE (200 OK):
------------------
{
  "id": 27,
  "creditoId": 15,
  "ordenId": 125,
  "numeroOrden": 1102,
  "cliente": {
    "id": 7,
    "nombre": "Juan PÃ©rez",
    "nit": "123456789"
  },
  "fecha": "2025-12-18",
  "total": 2555168.07,
  "metodoPago": "TRANSFERENCIA: 2.555.168,07 (BANCOLOMBIA) | RETEFUENTE Orden #1102: 54.831,93",
  "factura": "F-2025-001",
  
  // ğŸ†• CAMPOS NUEVOS EN RESPONSE
  "montoEfectivo": 0,
  "montoTransferencia": 2555168.07,
  "montoCheque": 0,
  "montoRetencion": 54831.93,
  
  "saldo": 0
}


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3ï¸âƒ£ LISTAR Ã“RDENES Y ABONOS DISPONIBLES PARA ENTREGA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT: GET /api/entregas/ordenes-disponibles
DESCRIPCIÃ“N: Lista Ã³rdenes de contado y abonos disponibles para incluir en entregas

QUERY PARAMS: Ninguno

RESPONSE (200 OK):
------------------
{
  "ordenesContado": [
    {
      "id": 130,
      "numero": 1105,
      "fecha": "2025-12-18",
      "clienteNombre": "Juan PÃ©rez",
      "clienteNit": "123456789",
      "total": 549800,
      "obra": "Proyecto Casa Blanca",
      "descripcion": "TRANSFERENCIA: 549.800 (BANCOLOMBIA)",
      "sedeNombre": "Sede Principal",
      "trabajadorNombre": "Carlos GÃ³mez",
      
      // ğŸ†• CAMPOS NUEVOS: MONTOS NUMÃ‰RICOS
      "montoEfectivo": 0,
      "montoTransferencia": 549800,
      "montoCheque": 0,
      
      "yaEntregada": false,
      "esContado": true,
      "estado": "ACTIVA",
      "venta": true
    }
  ],
  
  "abonosDisponibles": [
    {
      "id": 27,
      "ordenId": 125,
      "numeroOrden": 1102,
      "fechaOrden": "2025-12-15",
      "fechaAbono": "2025-12-18",
      "clienteNombre": "MarÃ­a LÃ³pez",
      "clienteNit": "987654321",
      "montoAbono": 2555168.07,
      "montoOrden": 2610000,
      "metodoPago": "TRANSFERENCIA: 2.555.168,07 (BANCOLOMBIA) | RETEFUENTE Orden #1102: 54.831,93",
      "factura": "F-2025-001",
      "obra": "Proyecto Norte",
      "sedeNombre": "Sede Principal",
      "trabajadorNombre": "Ana RodrÃ­guez",
      
      // ğŸ†• CAMPOS NUEVOS: MONTOS NUMÃ‰RICOS
      "montoEfectivo": 0,
      "montoTransferencia": 2555168.07,
      "montoCheque": 0,
      "montoRetencion": 54831.93,
      
      "yaEntregado": false,
      "estadoOrden": "ACTIVA",
      "ventaOrden": true
    }
  ]
}


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
4ï¸âƒ£ OBTENER DETALLE DE ORDEN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT: GET /api/ordenes/{id}
DESCRIPCIÃ“N: Obtiene el detalle completo de una orden

RESPONSE (200 OK):
------------------
{
  "id": 130,
  "numero": 1105,
  "fecha": "2025-12-18",
  "cliente": { "id": 7, "nombre": "Juan PÃ©rez", "nit": "123456789" },
  "sede": { "id": 1, "nombre": "Sede Principal" },
  "trabajador": { "id": 3, "nombre": "Carlos GÃ³mez" },
  "obra": "Proyecto Casa Blanca",
  "descripcion": "TRANSFERENCIA: 549.800 (BANCOLOMBIA)",
  "total": 549800,
  "subtotal": 462016.81,
  "iva": 87783.19,
  "descuentos": 0,
  
  // ğŸ†• CAMPOS NUEVOS
  "montoEfectivo": 0,
  "montoTransferencia": 549800,
  "montoCheque": 0,
  
  "credito": false,
  "tieneRetencionFuente": false,
  "retencionFuente": 0,
  "estado": "ACTIVA",
  "items": [...]
}


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
5ï¸âƒ£ LISTAR ABONOS DE UN CRÃ‰DITO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT: GET /api/creditos/{creditoId}/abonos
DESCRIPCIÃ“N: Lista todos los abonos de un crÃ©dito especÃ­fico

RESPONSE (200 OK):
------------------
[
  {
    "id": 27,
    "creditoId": 15,
    "ordenId": 125,
    "numeroOrden": 1102,
    "fecha": "2025-12-18",
    "total": 2555168.07,
    "metodoPago": "TRANSFERENCIA: 2.555.168,07 (BANCOLOMBIA) | RETEFUENTE Orden #1102: 54.831,93",
    "factura": "F-2025-001",
    
    // ğŸ†• CAMPOS NUEVOS
    "montoEfectivo": 0,
    "montoTransferencia": 2555168.07,
    "montoCheque": 0,
    "montoRetencion": 54831.93,
    
    "saldo": 0
  }
]


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6ï¸âƒ£ OBTENER DETALLE DE ENTREGA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ENDPOINT: GET /api/entregas/{id}
DESCRIPCIÃ“N: Obtiene el detalle completo de una entrega de dinero

RESPONSE (200 OK):
------------------
{
  "id": 50,
  "fechaEntrega": "2025-12-18",
  "sede": { "id": 1, "nombre": "Sede Principal" },
  "empleado": { "id": 5, "nombre": "Pedro MartÃ­nez" },
  "monto": 3104968.07,
  
  // MONTOS POR MÃ‰TODO DE PAGO
  "montoEfectivo": 0,
  "montoTransferencia": 3104968.07,
  "montoCheque": 0,
  "montoDeposito": 0,
  
  // ğŸ†• CAMPO NUEVO: RETENCIÃ“N TOTAL DE LA ENTREGA
  "montoRetencion": 54831.93,
  
  "modalidadEntrega": "TRANSFERENCIA",
  "estado": "PENDIENTE",
  "detalles": [
    {
      "ordenId": 130,
      "numeroOrden": 1105,
      "montoOrden": 549800,
      "esAbono": false
    },
    {
      "ordenId": 125,
      "numeroOrden": 1102,
      "montoOrden": 2555168.07,
      "esAbono": true,
      "abonoId": 27
    }
  ]
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ REGLAS DE NEGOCIO Y VALIDACIONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ Ã“RDENES DE CONTADO (credito = false):
   âœ… OBLIGATORIO: montoEfectivo + montoTransferencia + montoCheque = total - descuentos
   âœ… ValidaciÃ³n en: Backend (OrdenService) y Base de Datos (constraint)
   âœ… Si no coincide: HTTP 400 Bad Request

2ï¸âƒ£ Ã“RDENES A CRÃ‰DITO (credito = true):
   âœ… Los campos montoEfectivo, montoTransferencia, montoCheque se guardan como 0.00
   âœ… El constraint de BD no aplica para Ã³rdenes a crÃ©dito

3ï¸âƒ£ ABONOS:
   âœ… OBLIGATORIO: montoEfectivo + montoTransferencia + montoCheque = total
   âœ… Tolerancia: 0.01 (1 centavo por redondeo)
   âœ… ValidaciÃ³n en: Backend (AbonoService)
   âœ… Si no coincide: HTTP 400 Bad Request

4ï¸âƒ£ RETENCIÃ“N EN LA FUENTE:
   âœ… La retenciÃ³n NO se suma a los mÃ©todos de pago
   âœ… Es un campo informativo/contable
   âœ… En Orden: campo retencionFuente (ya existÃ­a)
   âœ… En Abono: campo montoRetencion (nuevo)
   âœ… En Entrega: campo montoRetencion = SUMA de retenciones de todos los abonos

5ï¸âƒ£ ENTREGA DE DINERO:
   âœ… montoRetencion = SUMA de todos los montoRetencion de los abonos incluidos
   âœ… Se calcula automÃ¡ticamente al crear/actualizar la entrega


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ COMPATIBILIDAD Y MIGRACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAMPOS DE TEXTO CONSERVADOS:
-----------------------------
âœ… Orden.descripcion â†’ Se mantiene para informes y trazabilidad
âœ… Abono.metodoPago â†’ Se mantiene para informes y trazabilidad

FORMATO DE TEXTO (sin cambios):
--------------------------------
Orden.descripcion: "TRANSFERENCIA: 549.800 (BANCOLOMBIA)"
Abono.metodoPago: "TRANSFERENCIA: 2.555.168,07 (BANCOLOMBIA) | RETEFUENTE Orden #1102: 54.831,93"

VALORES POR DEFECTO:
--------------------
Todos los campos nuevos tienen DEFAULT 0.00 en la base de datos
Los registros existentes tendrÃ¡n valores 0.00 en las columnas numÃ©ricas

MIGRACIÃ“N DE DATOS EXISTENTES:
-------------------------------
âš ï¸ IMPORTANTE: Este cambio NO migra automÃ¡ticamente los datos existentes
âš ï¸ Los registros creados antes de este cambio tendrÃ¡n:
   - descripcion/metodoPago: texto completo (conservado)
   - montoEfectivo/montoTransferencia/montoCheque/montoRetencion: 0.00

Se requiere un script adicional de migraciÃ³n para:
1. Parsear los campos de texto existentes
2. Extraer los montos numÃ©ricos
3. Actualizar las columnas numÃ©ricas

FRONTEND:
---------
âœ… Frontend antiguo: SeguirÃ¡ funcionando (lee descripcion/metodoPago)
âœ… Frontend nuevo: Debe enviar los campos numÃ©ricos en los requests
âœ… No breaking changes: Los endpoints siguen aceptando requests sin campos numÃ©ricos
   (se guardarÃ¡n como 0.00)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ EJEMPLOS DE USO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EJEMPLO 1: Crear orden de contado con pago mixto
-------------------------------------------------
POST /api/ordenes
{
  "clienteId": 7,
  "sedeId": 1,
  "credito": false,
  "descripcion": "EFECTIVO: 200.000 | TRANSFERENCIA: 349.800 (BANCOLOMBIA)",
  "montoEfectivo": 200000,
  "montoTransferencia": 349800,
  "montoCheque": 0,
  "items": [...]
}
â†’ Total calculado: 549.800
â†’ ValidaciÃ³n OK: 200.000 + 349.800 = 549.800 âœ…


EJEMPLO 2: Crear abono con retenciÃ³n
-------------------------------------
POST /api/creditos/15/abonos
{
  "total": 2555168.07,
  "metodoPago": "TRANSFERENCIA: 2.555.168,07 (BANCOLOMBIA) | RETEFUENTE: 54.831,93",
  "montoEfectivo": 0,
  "montoTransferencia": 2555168.07,
  "montoCheque": 0,
  "montoRetencion": 54831.93
}
â†’ ValidaciÃ³n OK: 0 + 2.555.168,07 + 0 = 2.555.168,07 âœ…
â†’ RetenciÃ³n: 54.831,93 (NO se suma a los mÃ©todos)


EJEMPLO 3: Error de validaciÃ³n
-------------------------------
POST /api/abonos
{
  "total": 100000,
  "montoEfectivo": 50000,
  "montoTransferencia": 45000,
  "montoCheque": 0
}
â†’ HTTP 400 Bad Request
â†’ Error: "La suma de los mÃ©todos de pago ($95000.00) no coincide con el monto total ($100000.00)"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… CHECKLIST DE IMPLEMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BACKEND:
--------
âœ… Script SQL ejecutado en MariaDB
âœ… Modelos actualizados (Orden, Abono, EntregaDinero)
âœ… DTOs actualizados (OrdenVentaDTO, AbonoDTO, etc.)
âœ… Servicios actualizados con validaciones
âœ… Controladores actualizados para incluir campos en responses

FRONTEND (PENDIENTE):
---------------------
â¬œ Actualizar formulario de creaciÃ³n de Ã³rdenes
   â†’ Agregar campos: montoEfectivo, montoTransferencia, montoCheque
   â†’ Validar que la suma = total antes de enviar

â¬œ Actualizar formulario de creaciÃ³n de abonos
   â†’ Agregar campos: montoEfectivo, montoTransferencia, montoCheque, montoRetencion
   â†’ Validar que la suma de mÃ©todos = total antes de enviar

â¬œ Actualizar vista de Ã³rdenes disponibles para entrega
   â†’ Mostrar columnas numÃ©ricas en tabla
   â†’ Usar valores numÃ©ricos para cÃ¡lculos

â¬œ Actualizar reportes y dashboards
   â†’ Usar campos numÃ©ricos para sumas y totales
   â†’ Mantener texto para visualizaciÃ³n legible

TESTING:
--------
â¬œ Probar creaciÃ³n de orden de contado con suma correcta
â¬œ Probar creaciÃ³n de orden de contado con suma incorrecta (debe fallar)
â¬œ Probar creaciÃ³n de orden a crÃ©dito (debe guardar 0.00 en mÃ©todos)
â¬œ Probar creaciÃ³n de abono con suma correcta
â¬œ Probar creaciÃ³n de abono con suma incorrecta (debe fallar)
â¬œ Probar endpoint ordenes-disponibles (debe incluir campos numÃ©ricos)
â¬œ Verificar que registros existentes no se rompan


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ CONTACTO Y SOPORTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Desarrollador: JAAL
Fecha: 2025-12-18
VersiÃ³n Backend: Spring Boot 3.3.4
Base de Datos: MariaDB

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIN DE LA DOCUMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
